#include <Arduino.h>

// signals from CSB
#define AI_pin 26
#define TRIGGER_pin 17
#define MODE_pin 18
#define TX_pin 16

bool trig_status =0;
int trigger_count = 0;
unsigned long x , y;
void callback()
{
  // y =  (micros() - x);
  trig_status = 1;
  trigger_count++;
  // Serial.println(y);
  //  x = micros();
}
void setup()
{

  pinMode(AI_pin, INPUT);
  pinMode (MODE_pin , INPUT);

  pinMode(TRIGGER_pin, INPUT);

  attachInterrupt(TRIGGER_pin, callback, RISING);
}
int analog_values[50];
int time_val[50];
void loop()
{

  if (trig_status)
  {
    y = micros()-x;
    x = micros();
    trig_status = 0;
    if (trigger_count >= 50)
    {
      detachInterrupt(TRIGGER_pin);
      Serial.print("analog values : ");
      for (int i = 1; i < 50; i++)
      {
        Serial.print(analog_values[i]);
        Serial.print("\t");
      }
      Serial.print("\ntime : ");
      for (int i = 1; i < 50; i++)
      {
        Serial.print(time_val[i]);
        Serial.print("\t");
      }
      Serial.println("");
      trigger_count = 0;
      if (digitalRead(MODE_pin))
        attachInterrupt(TRIGGER_pin, callback, RISING);
    }
    else
    {
      analog_values[trigger_count] = analogRead(AI_pin);
      time_val[trigger_count] = y;
    }
  }
}
