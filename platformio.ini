; PlatformIO Project Configuration File
;
; HUB System Combined Board V1.0 - Clean deployment configurations
;
; To build:
;   pio run -e hub_master    (for master/hub)
;   pio run -e hub_slot      (for slot with sample count support)
;
; To upload:
;   pio run -e hub_master -t upload
;   pio run -e hub_slot -t upload

[platformio]
default_envs = hub_slot
src_dir = src
include_dir = include
lib_dir = lib

[env]
platform = https://github.com/maxgerhardt/platform-raspberrypi.git
board = pico
framework = arduino
board_build.core = earlephilhower
monitor_speed = 230400
lib_deps = 
    Wire
    adafruit/Adafruit NeoPixel
    SdFat
    IOEX
    MFLSensorHead
    shift_register
    High_Speed_ADC
    EasyTransfer
    EEPROM

; Common build flags for all environments
build_flags = 
    -D SERIAL_BAUDRATE=921600
    -I include
    -I lib

; ================================
; HUB MASTER DEPLOYMENT
; ================================
; Central controller that manages up to 5 slots via I2C and Serial communication
; Features: Menu system, I2C broadcasting, slot power control, SD card management
[env:hub_master]
upload_port = COM13              ; Serial port for flashing master (adjust as needed)
monitor_port = COM13             ; Serial port for debugging master
build_flags = 
    ${env.build_flags}
    -D BUILD_MASTER              ; Compiles master-specific code (hub_master.cpp)
    -D MASTER_VERSION=\"2.0.0\"     ; Version string for identification
    -D BAUDRATE=152000           ; USB serial baud rate for user interface
    -D DEFAULT_SENSOR_TYPE=1     ; Default sensor: 1=EGP (5V), 0=MFL (3.3V)
    ; Configuration options:
    ;   DEFAULT_SENSOR_TYPE=0    → MFL sensors (3.3V) - magnetic flux leakage
    ;   DEFAULT_SENSOR_TYPE=1    → EGP sensors (5V) - eddy gap probe

; ================================
; HUB SLOT - Enhanced with sample count support  
; ================================
; Individual sensor acquisition nodes controlled by master
; Features: Sensor data collection, SD logging, I2C slave communication
[env:hub_slot]
upload_port = COM14              ; Serial port for flashing slot (adjust as needed)
monitor_port = COM14             ; Serial port for debugging slot
build_flags = 
    ${env.build_flags}
    -D BUILD_SLOT                ; Compiles slot-specific code (hub_slot.cpp)
    -D DEFAULT_SLOT_ID=3         ; Default slot ID (1-5) if not configured
    -D SLOT_VERSION=\"2.1.0\"       ; Version string for identification
    -D EGP                       ; Sensor type: EGP (alternative: MFL)
    -D COM_BAUDRATE=152000       ; Master-slot serial communication baud rate
    ; Configuration options:
    ;   EGP                      → Eddy Gap Probe sensors (5V, 20 TMAG sensors)
    ;   MFL                      → Magnetic Flux Leakage sensors (3.3V)
    ;   DEFAULT_SLOT_ID=1-5      → Physical slot position in hub

; ================================
; DEPLOYMENT ENVIRONMENTS
; ================================
; These environments are used by the automated deployment scripts
; (deploy_complete_system.py, deploy_slots.py, etc.)

[env:hub_master_deploy]
upload_port = COM13              ; Master deployment port
monitor_port = COM13             ; Master monitoring port
build_flags = 
    ${env.build_flags}
    -D BUILD_MASTER              ; Compiles master-specific code
    -D MASTER_VERSION=\"2.0.0\"     ; Version string
    -D BAUDRATE=152000           ; USB serial baud rate
    -D DEFAULT_SENSOR_TYPE=0     ; Default MFL for master deployment

[env:hub_slot1_deploy]
upload_port = COM14              ; Slot 1 deployment port
monitor_port = COM14             ; Slot 1 monitoring port
build_flags = 
    ${env.build_flags}
    -D BUILD_SLOT                ; Compiles slot-specific code
    -D DEFAULT_SLOT_ID=1         ; Slot 1 identifier
    -D SLOT_VERSION=\"2.1.0\"       ; Version string
    -D MFL                       ; Slot 1 sensor type
    -D COM_BAUDRATE=152000       ; Master-slot communication baud

[env:hub_slot2_deploy]
upload_port = COM15              ; Slot 2 deployment port
monitor_port = COM15             ; Slot 2 monitoring port
build_flags = 
    ${env.build_flags}
    -D BUILD_SLOT                ; Compiles slot-specific code
    -D DEFAULT_SLOT_ID=2         ; Slot 2 identifier
    -D SLOT_VERSION=\"2.1.0\"       ; Version string
    -D MFL                       ; Slot 2 sensor type
    -D COM_BAUDRATE=152000       ; Master-slot communication baud

[env:hub_slot3_deploy]
upload_port = COM16              ; Slot 3 deployment port
monitor_port = COM16             ; Slot 3 monitoring port
build_flags = 
    ${env.build_flags}
    -D BUILD_SLOT                ; Compiles slot-specific code
    -D DEFAULT_SLOT_ID=3         ; Slot 3 identifier
    -D SLOT_VERSION=\"2.1.0\"       ; Version string
    -D EGP                       ; Slot 3 sensor type (currently EGP)
    -D COM_BAUDRATE=152000       ; Master-slot communication baud

[env:hub_slot4_deploy]
upload_port = COM17              ; Slot 4 deployment port
monitor_port = COM17             ; Slot 4 monitoring port
build_flags = 
    ${env.build_flags}
    -D BUILD_SLOT                ; Compiles slot-specific code
    -D DEFAULT_SLOT_ID=4         ; Slot 4 identifier
    -D SLOT_VERSION=\"2.1.0\"       ; Version string
    -D MFL                       ; Slot 4 sensor type
    -D COM_BAUDRATE=152000       ; Master-slot communication baud

[env:hub_slot5_deploy]
upload_port = COM18              ; Slot 5 deployment port
monitor_port = COM18             ; Slot 5 monitoring port
build_flags = 
    ${env.build_flags}
    -D BUILD_SLOT                ; Compiles slot-specific code
    -D DEFAULT_SLOT_ID=5         ; Slot 5 identifier
    -D SLOT_VERSION=\"2.1.0\"       ; Version string
    -D MFL                       ; Slot 5 sensor type
    -D COM_BAUDRATE=152000       ; Master-slot communication baud